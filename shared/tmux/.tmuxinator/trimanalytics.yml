name: trimanalytics
root: <%= ENV["PROJECT_DIR"] %>/trimanalytics
# needed for pane-base-index 1 config
startup_pane: 1
# Runs in each window and pane before window/pane specific commands
pre_window:
  - nvm use
  - load_dotenv_vars

windows:
  - editor:
      layout: main-horizontal
      panes:
        - vim -c "silent VtrAttachToPane 3"
        -
        -
  # the procfile.hot decompossed
  - server:
      layout: even-horizontal
      panes:
        - REACT_ON_RAILS_ENV=HOT rails s -b 0.0.0.0
        - sh -c 'rm app/assets/webpack/* || true && HOT_RAILS_PORT=3500 yarn run hot-assets'
  - workers:
      layout: even-horizontal
      panes:
        - bundle exec sidekiq -c $DEFAULT_WORKER_CONCURRENCY -q default -q mailers -q low_priority
        - bundle exec sidekiq -c $DEFAULT_WORKER_CONCURRENCY -q critical
        - bundle exec sidekiq -c $RESOURCE_INTENSIVE_WORKER_CONCURRENCY -q resource_intensive
  - ngrok: ngrok start --all
