name: doximity
root: <%= ENV["PROJECT_DIR"] %>/doximity
# needed for pane-base-index 1 config
startup_pane: 1
# Runs in each window and pane before window/pane specific commands
pre_window: nvm use

windows:
  - editor:
      layout: main-horizontal
      panes:
        - vim -c "silent VtrAttachToPane 3"
        - local_shell:
          - wait_for_docker doximity
          - dox-dc exec doximity bundle install
        - docker_shell:
          - wait_for_docker doximity
          - dox-do bundle
          - dox-do rails db:migrate
          - dox-do bash
  - server:
      layout: even-horizontal
      panes:
        - dox_server:
          - dox-dc up -d doximity
          - dox-attach doximity
        - dox_sync:
          - cd <%= ENV["PROJECT_DIR"] %>/dox-compose
          - docker-sync start -f -n doximity-sync
  - services:
    - wait_for_docker doximity
    - dox-dc up doximity-workers
  - bullet: tail -f log/bullet.log
  - consoles:
    - wait_for_docker doximity
    - dox-dc exec doximity rails c
