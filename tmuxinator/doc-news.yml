name: doc-news
root: <%= ENV["PROJECT_DIR"] %>/doc-news
# needed for pane-base-index 1 config
startup_pane: 1

windows:
  - editor:
      layout: main-horizontal
      panes:
        - vim -c "silent VtrAttachToPane 3"
        local_shell:
          - wait_for_docker doc-news
          - dox-do bundle install
        docker_shell:
          - wait_for_docker doc-news
          - dox-dc exec doc-news sh
  - server:
      layout: even-vertical
      panes:
        - dox-dc up doc-news
        - sync:
          - cd <%= ENV["PROJECT_DIR"] %>/dox-compose
          - docker-sync start -f -n doc-news-sync
  - services:
      layout: main-horizontal
      panes:
        - sidekiq:
          - wait_for_docker doc-news
          - dox-dc exec doc-news bundle exec sidekiq
        - consumers:
          - wait_for_docker doc-news
          - dox-dc exec doc-news bundle exec rake consumers:run
        - ads_consumers:
          - wait_for_docker doc-news
          - dox-dc exec doc-news bundle exec rake ads_consumers:run
  - consoles:
      panes:
        - rails_console:
          - wait_for_docker doc-news
          - dox-dc exec doc-news rails console
